<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <%- include('../partials/headtag'); %>
</head>
<script src="/js/sorttable.js"></script>
<body>
    <header>
        <div class="header-area ">
            <div id="sticky-header" class="main-header-area">
                <div class="container-fluid">
                    <div class="header_bottom_border">
                        <div class="row align-items-center">
                            <div class="col-xl-2 col-lg-2">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="/images/logo.png" alt="">
                                    </a>
                                </div>
                            </div>
                            <div class="col-xl-7 col-lg-7">
                                <div class="main-menu  d-none d-lg-block">
                                    <nav>
                                        <ul id="navigation">
                                            <li>
                                                <a href="/">Home</a>
                                            </li>
                                            <% if (isAuthenticated) { %>
                                            <li>
                                                <a href="/admin/addtours">AddTours</a>
                                            </li>
                                            <li>
                                                <a href="/admin/addaccomodation">AddAccod</a>
                                            </li>
                                            <li>
                                                <a href="/admin/accoddetails">Accod</a>
                                            </li>
                                            <li>
                                                <a href="/admin/viewregistration">Reg</a>
                                            </li>
                                            <li>
                                                <a href="/admin/viewmails">Mail</a>
                                            </li>
                                            <li>
                                                <a href="/admin/code">Code</a>
                                            </li>
                                            <li>
                                                <a href="/admin/addblog">Blog</a>
                                            </li>
                                            <li>
                                                <a href="/admin/makepdf">Create Pdf</a>
                                            </li>
                                            <li>
                                                <form action="/admin/logout" method="post">
                                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                    <button type="submit" class="btn btn-primary">Logout</button>
                                                </form>
                                            </li>
                                            <% } else{ %> 
                                            <li>
                                                <button class="btn btn-primary" data-toggle="modal" data-target="#myModal">Login</button>
                                            </li>
                                            <% } %>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-3 d-none d-lg-block">
                                <div class="social_wrap d-flex align-items-center justify-content-end">
                                    <!-- <div class="number">
                                        <p> <i class="fa fa-phone"></i>+91 851111 7891</p>
                                    </div> -->
                                    <div class="social_links d-none d-xl-block">
                                        <ul>
                                            <li><a href="https://www.instagram.com/dejavutours/"> <i class="fa fa-instagram"></i> </a></li>
                                            <li><a href="https://www.youtube.com/watch?v=56-u7Pv-cQg"> <i class="fa fa-youtube-play"></i> </a></li>
                                            <li><a href="https://www.facebook.com/dejavutours.in"> <i class="fa fa-facebook"></i> </a></li>
                                            <li><a href="https://twitter.com/dejavutours_in"> <i class="fa fa-twitter"></i> </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="seach_icon">
                                <a data-toggle="modal" data-target="#exampleModalCenter" href="#">
                                    <i class="fa fa-search"></i>
                                </a>
                            </div>
                            <div class="col-12">
                                <div class="mobile_menu d-block d-lg-none"></div>
                            </div>
                        </div>
                    </div>
    
                </div>
            </div>
        </div>
    </header>
    <!-- header-end -->
    
      <!-- The Modal -->
      <div class="modal fade" id="myModal">
        <div class="modal-dialog">
          <div class="modal-content">
          
            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Login</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            
            <!-- Modal body -->
            <div class="modal-body">
                <form action="/admin/login" method="POST">
                    <div class="form-group">
                      <label for="username"><b>Username:</b></label>
                      <input type="text" name="username" class="form-control" id="username">
                    </div>
                    <div class="form-group">
                      <label for="passowrd"><b>Password:</b></label>
                      <input type="password" name="password" class="form-control" id="passowrd">
                    </div> 
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>"> 
                    <button type="submit" class="btn btn-primary">login</button>
                </form> 
            </div>    
          </div>
        </div>
      </div>

            <!-- body-->
            
            <div class="container-fluid">
                <input class="form-control" id="myInput" type="text" placeholder="Search..">
                <br>
              <!-- <button class="btn btn-success" onclick="exportData()">Download</button>--> 
                <div class="row">
                    <table class="table table-hover table-sm" id="downloadtable">
                        <thead>
                        <tr class="table-primary">
                            <th scope="col" onclick="w3.sortHTML('#myTable', '.item', 'td:nth-child(1)')" style="cursor:pointer">ID</th>
                            <th scope="col" onclick="w3.sortHTML('#myTable', '.item', 'td:nth-child(2)')" style="cursor:pointer">Title</th>
                            <th scope="col" onclick="w3.sortHTML('#myTable', '.item', 'td:nth-child(3)')" style="cursor:pointer">Route</th>
                            <th scope="col" onclick="w3.sortHTML('#myTable', '.item', 'td:nth-child(3)')" style="cursor:pointer">Filename</th>
                            <th scope="col">Edit</th>
                           <!-- <th scope="col">Download</th>--> 
                            <th scope="col">Delete</th>
                        </tr>
                        </thead>
                        <tbody id="myTable">
                            <% var i = 0 %>
                            <% for (let trip of trippdfs ) { %>
                                <% i = i + 1 %>
                                <tr class="item">
                                    <td scope="col"><%= i %></td>
                                    <td scope="col"><%= trip.title %></td>
                                    <td scope="col"><%= trip.route %></td>
                                    <td scope="col"><%= (trip.filename == '') ? 'PdfTrip.pdf' : trip.filename %></td>
                                    <td>
                                        <form  action="/admin/editpdftrip" method="POST">
                                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                            <input type="hidden" name="tripid" value="<%= trip._id %>">
                                            <button class="btn btn-primary">Edit & Download PDF&nbsp;</button>
                                        </form>
                                    </td>
                              <!--     <td>
                                 <button class="btn btn-primary"><a href="/admin/downloadtrippdf/<%= trip._id %>">PDF&nbsp;<i class="fa fa-download"></i></a></button>
                                </td>--> 
                                <td>
                                        <form method="POST" action="/admin/deletetrip">
                                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                            <input type="hidden" name="tripid" value="<%= trip._id %>">
                                            <button class="btn btn-danger" type="submit">Delete</button>
                                        </form>
                                    </td>         
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
          </div>


    <%- include('../partials/footer'); %>
    <%- include('../partials/scripttag'); %>
    <script>
        $(document).ready(function(){
          $("#myInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#myTable tr").filter(function() {
              $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
          });
        });
    </script>
    <script>
        function exportData(){
    /* Get the HTML data using Element by Id */
    var table = document.getElementById("downloadtable");
 
    /* Declaring array variable */
    var rows =[];
 
      //iterate through rows of table
    for(var i=0,row; row = table.rows[i];i++){
        //rows would be accessed using the "row" variable assigned in the for loop
        //Get each cell value/column from the row
        column1 = row.cells[0].innerText;
        column2 = row.cells[1].innerText;
        column3 = row.cells[2].innerText;
        column4 = row.cells[3].innerText;

 
    /* add a new records in the array */
        rows.push(
            [
                column1,
                column2,
                column3,
                column4,
            ]
        );
 
        }
        csvContent = "data:text/csv;charset=utf-8,";
         /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
        rows.forEach(function(rowArray){
            row = rowArray.join(",");
            csvContent += row + "\r\n";
        });
 
        /* create a hidden <a> DOM node and set its download attribute */
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "Registration.csv");
        document.body.appendChild(link);
         /* download the data file named "Stock_Price_Report.csv" */
        link.click();
}
    </script>
</body>

</html>